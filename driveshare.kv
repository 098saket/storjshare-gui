### Custom widgets for Storj's DriveShare
<-Block@BoxLayout>:
	canvas.before:
		Color:
			rgba: app.BACKGROUND
		Rectangle:
			pos: self.pos
			size: self.size

<-Mybar@ProgressBar>:
	canvas:
		Color:
			rgb: 1, 1, 1
		BorderImage:
			border: (2, 2, 2, 2)
			pos: self.x, self.center_y - 10
			size: self.width, 10
			source: './images/storj-progressbar_background.png'
		BorderImage:
			border: (2 if self.value > 0 else 0, 2 if self.value > 0 else 0, 2, self.width * (self.value / float(self.max)))
			pos: self.x, self.center_y - 10
			size: self.width * (self.value / float(self.max)) if self.max else 0, 10
			source: './images/storj-progressbar.png'

<-ActionButton@Button>:
	background_normal: './images/corners.png'
	background_down: './images/corners_down.png'
	border: 7, 7, 7, 7
	state_image: self.background_normal if self.state == 'normal' else self.background_down
	disabled_image: self.background_disabled_normal if self.state == 'normal' else self.background_disabled_down
	font_name: './fonts/Montserrat-Bold.ttf'
	canvas:
		Color:
			rgba: self.background_color
		BorderImage:
			border: self.border
			pos: self.pos
			size: self.size
			source: self.disabled_image if self.disabled else self.state_image
		Color:
			rgba: 1, 1, 1, 1
		Rectangle:
			texture: self.texture
			size: self.texture_size
			pos: int(self.center_x - self.texture_size[0] / 2.0), int(self.center_y - self.texture_size[1] / 2.)


### Widgets
<MainMenu>:
	id: main_menu
	orientation: 'vertical'
	spacing: 1
	canvas.before:
		Color:
			rgba: app.LIGHT_GREY
		Rectangle:
			pos: self.pos
			size: self.size

	### Title row
	Block:
		orientation: 'horizontal'
		size_hint: 1.0, 0.09
		padding: 20, 0
		Label:
			text: main_menu.top_row_text
			size_hint: 0.85, 1.0
			text_size: self.size
			valign: 'middle'
			font_name: './fonts/Montserrat-Bold.ttf'
			color: app.DARK_GREY
			font_size: '19sp'
		Button:
			text: "?"
			pos_hint: {'top': 0.71}
			font_name: './fonts/DroidSansMono.ttf'
			size_hint: 0.15, 0.4
			color: app.DARK_YELLOW
			background_color: app.YELLOW
			background_normal: './images/cancel_btn.png'
			background_down: './images/cancel_btn_down.png'
			border: 9, 9, 14, 14
			on_release: app.app_goto_site_callback()

	### Storage bar
	Block:
		orientation: 'vertical'
		size_hint: 1.0, 0.11
		padding: 20, 0
		BoxLayout:
			orientation: 'horizontal'
			size_hint: 1.0, 0.33
			Label:
				id: storage_space_title
				text: "Storage Space"
				text_size: self.size
				size_hint: 0.5, 1.0
				font_size: '14sp'
				bold: True
				color: app.DARK_GREY
			Label:
				id: storage_space_label
				text: main_menu.storage_percent
				size_hint: 0.5, 1.0
				text_size: self.size
				halign: 'right'
				bold: True
				font_size: '14sp'
				color: app.DARK_GREY
		BoxLayout:
			orientation: 'horizontal'
			size_hint: 1.0, 0.33
			Mybar:
				id: storage_bar
				size_hint: 1.0, 1.0
				value: 0

		BoxLayout:
			orientation: 'horizontal'
			size_hint: 1.0, 0.33
			Label:
				id: storage_space_lower_label
				text: main_menu.lower_storage_limit
				text_size: self.size
				valign: 'top'
				size_hint: 0.5, 1.0
				font_size: '12sp'
				color: app.GREY
			Label:
				id: storage_space_upper_label
				text: main_menu.upper_storage_limit
				text_size: self.size
				halign: 'right'
				valign: 'top'
				size_hint: 0.5, 1.0
				font_size: '12sp'
				color: app.GREY

	### Storage information
	BoxLayout:
		orientation: 'horizontal'
		size_hint: 1.0, 0.07
		spacing: 1
		Block:
			orientation: 'vertical'
			size_hint: 0.33, 1.0
			padding: 0, 10
			Label:
				id: storage_space_free_title
				text: "FREE"
				font_size: '12sp'
				color: app.GREY
			Label:
				id: storage_space_free_label
				text: main_menu.free_amount
				font_size: '16sp'
				font_name: './fonts/Montserrat-Bold.ttf'
				color: app.DARK_GREY
		Block:
			orientation: 'vertical'
			size_hint: 0.33, 1.0
			padding: 0, 10
			Label:
				id: storage_space_used_title
				text: "USED"
				font_size: '12sp'
				color: app.GREY
			Label:
				id: storage_space_used_label
				text: main_menu.used_amount
				font_size: '16sp'
				font_name: './fonts/Montserrat-Bold.ttf'
				color: app.DARK_GREY
		Block:
			orientation: 'vertical'
			size_hint: 0.33, 1.0
			padding: 0, 10
			Label:
				id: storage_space_total_title
				text: "TOTAL"
				font_size: '12sp'
				color: app.GREY
			Label:
				id: storage_space_total_label
				text: main_menu.total_amount
				font_size: '16sp'
				font_name: './fonts/Montserrat-Bold.ttf'
				color: app.DARK_GREY

	### Button row
	Block:
		orientation: 'horizontal'
		size_hint: 1.0, 0.1
		padding: 20, 0
		spacing: 10
		ActionButton:
			id: settings_btn
			pos_hint: {'center_y': 0.5}
			text: "SETTINGS"
			size: 100, 40
			font_size: '16sp'
			size_hint: 0.5, None
			background_color: app.BLUE
			on_release: main_menu.go_settings()
		ActionButton:
			id: go_btn
			pos_hint: {'center_y': 0.5}
			text: main_menu.go_text
			actual_state: 'normal'
			size: 100, 40
			font_size: '16sp'
			size_hint: 0.5, None
			background_color: app.GREEN
			on_release: main_menu.go_toggle(go_btn)

<SettingsMenu>:
	id: settings_menu
	orientation: 'vertical'
	pos_hint: {'top': 1.0}
	spacing: 1
	canvas.before:
		Color:
			rgba: app.LIGHT_GREY
		Rectangle:
			pos: self.pos
			size: self.size
	Block:
		orientation: 'horizontal'
		size_hint: 1.0, 0.09
		padding: 20, 0
		Label:
			text: 'SETTINGS'
			size_hint: 0.53, 1.0
			text_size: self.size
			valign: 'middle'
			font_name: './fonts/Montserrat-Bold.ttf'
			color: app.DARK_GREY
			font_size: '19sp'
			bold: True
		Button:
			text: "LOGS"
			pos_hint: {'top': 0.71}
			size_hint: 0.30, 0.4
			color: app.DARK_YELLOW
			background_color: app.YELLOW
			background_normal: './images/cancel_btn.png'
			background_down: './images/cancel_btn_down.png'
			border: 9, 9, 14, 14
		Label:
			# Placeholder for correct spacing
			size_hint: 0.02, 1
		Button:
			text: "?"
			pos_hint: {'top': 0.71}
			font_name: './fonts/DroidSansMono.ttf'
			size_hint: 0.15, 0.4
			color: app.DARK_YELLOW
			background_color: app.YELLOW
			background_normal: './images/cancel_btn.png'
			background_down: './images/cancel_btn_down.png'
			border: 9, 9, 14, 14
			on_release: app.app_goto_site_callback()

	BoxLayout:
		orientation: 'vertical'
		size_hint: 1.0, 0.24
		spacing: 1

		Block:
			orientation: 'horizontal'
			padding: 20, 0
			size_hint: 1.0, 0.33
			Label:
				size_hint: 0.61, 1
				text: "Share Space [GB]"
				text_size: self.size
				font_size: '14sp'
				bold: True
				color: app.DARK_GREY
				valign: 'middle'
			# This is sort of stupid, but a vertically oriented BoxLayout is used as a sort of wrapper to center the textinput vertically, because Kivy's TextInput apparently does not support valign yet.
			BoxLayout:
				orientation: 'vertical'
				size_hint: 0.26, 1
				BoxLayout:
					size_hint_y: 1
				TextInput:
					text: settings_menu.allocated_space
					background_normal: './images/textinput_inactive.png'
					background_active: './images/textinput_active.png'
					font_size: '12sp'
					multiline: False
					disabled: False
					size_hint_y: None
					size: self.width, 30
				BoxLayout:
					size_hint_y: 1

		Block:
			orientation: 'horizontal'
			padding: 20, 0
			size_hint: 1.0, 0.33
			Label:
				size_hint: 0.3, 1
				text: "Folder"
				text_size: self.size
				font_size: '14sp'
				bold: True
				color: app.DARK_GREY
				valign: 'middle'
			BoxLayout:
				orientation: 'horizontal'
				size_hint: 0.7, 1
				spacing: 7
				BoxLayout:
					orientation: 'vertical'
					size_hint: 0.45, 1
					BoxLayout:
						size_hint_y: 1
					TextInput:
						background_normal: './images/textinput_inactive.png'
						background_active: './images/textinput_active.png'
						text: app.folder
						font_size: '12sp'
						disabled: False
						multiline: False
						size_hint_y: None
						size: self.width, 30
					BoxLayout:
						size_hint_y: 1
				BoxLayout:
					orientation: 'vertical'
					size_hint: 0.25, 1
					BoxLayout:
						size_hint_y: 1
					ActionButton:
						text: 'Browse'
						size_hint_y: None
						size: self.width, 30
						valign: 'middle'
						font_size: '12sp'
						background_color: app.BLUE
						on_release: settings_menu.show_fileselect()
					BoxLayout:
						size_hint_y: 1

		Block:
			orientation: 'horizontal'
			padding: 20, 0
			size_hint: 1.0, 0.33
			Label:
				size_hint: 0.3, 1
				text: "Node"
				text_size: self.size
				font_size: '14sp'
				bold: True
				color: app.DARK_GREY
				valign: 'middle'
			BoxLayout:
				orientation: 'vertical'
				size_hint: 0.7, 1
				BoxLayout:
					size_hint_y: 1
				TextInput:
					font_size: '12sp'
					multiline: False
					disabled: False
					size_hint_y: None
					size: self.width, 30
					disabled: False
					background_normal: './images/textinput_inactive.png'
					background_active: './images/textinput_active.png'
					text: settings_menu.node
				BoxLayout:
					size_hint_y: 1

		Block:
			orientation: 'horizontal'
			padding: 20, 0
			size_hint: 1.0, 0.33
			Label:
				size_hint: 0.3, 1
				text: "Payout Address"
				text_size: self.size
				font_size: '14sp'
				bold: True
				color: app.DARK_GREY
				valign: 'middle'
			BoxLayout:
				orientation: 'vertical'
				size_hint: 0.7, 1
				BoxLayout:
					size_hint_y: 1
				TextInput:
					background_normal: './images/textinput_inactive.png'
					background_active: './images/textinput_active.png'
					text: settings_menu.payout_address
					font_size: '12sp'
					disabled: False
					multiline: False
					size_hint_y: None
					size: self.width, 30
				BoxLayout:
					size_hint_y: 1

	Block:
		size_hint: 1.0, 0.1
		orientation: 'horizontal'
		padding: 20, 0
		spacing: 10
		ActionButton:
			text: 'CANCEL'
			size: 100, 40
			font_size: '16sp'
			pos_hint: {'center_y': 0.5}
			size_hint: 0.5, None
			background_color: app.RED
			on_release: settings_menu.go_main()
		ActionButton:
			text: 'OK'
			size: 100, 40
			pos_hint: {'center_y': 0.5}
			font_size: '16sp'
			size_hint: 0.5, None
			background_color: app.BLUE
			on_release: settings_menu.save_settings(settings_menu)

<FileSelectDialog>:
	text_input: text_input
	BoxLayout:
		size: root.size
		pos: root.pos
		orientation: "vertical"
		FileChooserListView:
			id: filechooser
			on_selection: text_input.text = self.selection and self.selection[0] or ''

		TextInput:
			id: text_input
			size_hint_y: None
			height: 30
			multiline: False

		BoxLayout:
			size_hint_y: None
			height: 30
			Button:
				text: "Cancel"
				on_release: root.cancel()
			Button:
				text: "Select"
				on_release: root.select(filechooser.path, text_input.text)

<MainScreen>:
	MainMenu:

<SettingsScreen>:
	SettingsMenu:
